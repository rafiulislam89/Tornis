!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):(t=t||self,i(t.tornis={}))}(this,function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function e(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function s(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}function a(t,i){var e=0;return function(){var s=(new Date).getTime();if(!(s-e<t))return e=s,i.apply(void 0,arguments)}}function h(t){return Math.floor(t.reduce(function(t,i){return t+i},0)/t.length)}var o="undefined"==typeof window,n=new(function(){function t(){i(this,t),o||(this.lastX=0,this.lastY=0,this.lastWidth=window.innerWidth,this.lastHeight=window.innerHeight,this.lastMouseX=0,this.lastMouseY=0,this.lastWindowX=window.screenX,this.lastWindowY=window.screenY,this.lastAlpha=0,this.lastBeta=0,this.lastGamma=0,this.currAlpha=0,this.currBeta=0,this.currGamma=0,this.scrollHeight=document.body.scrollHeight,this.scrollChange=!1,this.sizeChange=!1,this.mouseChange=!1,this.positionChange=!1,this.orientationChange=!1,this.devicePixelRatioChange=!1,this.currX=0,this.currY=0,this.currWidth=window.innerWidth,this.currHeight=window.innerHeight,this.currMouseX=0,this.currMouseY=0,this.currWindowX=0,this.currDevicePixelRatio=this.lastDevicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.mouseXVelocity=[],this.mouseYVelocity=[],this.lastMouseXVelocity=0,this.lastMouseYVelocity=0,this.windowXVelocity=[],this.windowYVelocity=[],this.lastWindowXVelocity=0,this.lastWindowYVelocity=0,this.updating=!1,this.callbacks=[],this.update=this.update.bind(this),this.handleResize=this.handleResize.bind(this),this.handleMouse=this.handleMouse.bind(this),this.handleOrientation=this.handleOrientation.bind(this),this.recalibrateOrientation=this.recalibrateOrientation.bind(this),this.formatData=this.formatData.bind(this),this.watch=this.watch.bind(this),this.unwatch=this.unwatch.bind(this),this.handleResize=a(110,this.handleResize),this.handleMouse=a(75,this.handleMouse),window.addEventListener("resize",this.handleResize),window.addEventListener("mousemove",this.handleMouse),window.addEventListener("deviceorientation",this.handleOrientation),requestAnimationFrame(this.update))}return s(t,[{key:"handleResize",value:function(t){this.currWidth=window.innerWidth,this.currHeight=window.innerHeight}},{key:"handleMouse",value:function(t){this.currMouseX=t.clientX,this.currMouseY=t.clientY}},{key:"handleOrientation",value:function(t){this.initialAlpha||(this.initialAlpha=t.alpha),this.initialBeta||(this.initialBeta=t.beta),this.initialGamma||(this.initialGamma=t.gamma),this.currAlpha=t.alpha,this.currBeta=t.beta,this.currGamma=t.gamma}},{key:"recalibrateOrientation",value:function(){var t={prev:{alpha:this.initialAlpha,beta:this.initialBeta,gamma:this.initialGamma}};return this.initialAlpha=this.lastAlpha,this.initialBeta=this.lastBeta,this.initialGamma=this.lastGamma,t.current={alpha:this.initialAlpha,beta:this.initialBeta,gamma:this.initialGamma},t}},{key:"formatData",value:function(){return{scroll:{changed:this.scrollChange,left:Math.floor(this.lastX),right:Math.floor(this.lastX+this.lastWidth),top:Math.floor(this.lastY),bottom:Math.floor(this.lastY+this.lastHeight),velocity:{x:Math.floor(this.scrollXVelocity)||0,y:Math.floor(this.scrollYVelocity)||0}},size:{changed:this.sizeChange,x:Math.floor(this.lastWidth),y:Math.floor(this.lastHeight),docY:Math.floor(this.scrollHeight)},mouse:{changed:this.mouseChange,x:Math.floor(this.lastMouseX),y:Math.floor(this.lastMouseY),velocity:{x:Math.floor(this.lastMouseXVelocity)||0,y:Math.floor(this.lastMouseYVelocity)||0}},position:{changed:this.positionChange,left:Math.floor(this.lastWindowX),right:Math.floor(this.lastWindowX+this.lastWidth),top:Math.floor(this.lastWindowY),bottom:Math.floor(this.lastWindowY+this.lastHeight),velocity:{x:Math.floor(this.lastWindowXVelocity)||0,y:Math.floor(this.lastWindowYVelocity)||0}},orientation:{changed:this.orientationChange,alpha:Math.floor(this.lastAlpha-this.initialAlpha)||0,beta:Math.floor(this.lastBeta-this.initialBeta)||0,gamma:Math.floor(this.lastGamma-this.initialGamma)||0},devicePixelRatio:{changed:this.devicePixelRatioChange,ratio:this.currDevicePixelRatio}}}},{key:"update",value:function(){var t=this,i=this.currWidth,e=this.currHeight,s=this.currMouseX,a=this.currMouseY,o=this.currAlpha,n=this.currBeta,l=this.currGamma;this.currDevicePixelRatio;if(this.updating)return!1;this.scrollChange=this.sizeChange=this.mouseChange=this.positionChange=this.orientationChange=this.devicePixelRatioChange=!1,this.windowXVelocity.length>5&&this.windowXVelocity.shift(),this.windowXVelocity.push(window.screenX-this.lastWindowX),h(this.windowXVelocity)!=this.lastWindowXVelocity&&(this.lastWindowXVelocity=h(this.windowXVelocity),this.positionChange=!0),window.screenX!=this.lastWindowX&&(this.positionChange=!0,this.lastWindowX=window.screenX),this.windowYVelocity.length>5&&this.windowYVelocity.shift(),this.windowYVelocity.push(window.screenY-this.lastWindowY),h(this.windowYVelocity)!=this.lastWindowYVelocity&&(this.lastWindowYVelocity=h(this.windowYVelocity),this.positionChange=!0),window.screenY!=this.lastWindowY&&(this.positionChange=!0,this.lastWindowY=window.screenY),window.pageXOffset==this.lastX&&0!=this.scrollXVelocity&&(this.scrollXVelocity=0,this.scrollChange=!0),window.pageYOffset==this.lastY&&0!=this.scrollYVelocity&&(this.scrollYVelocity=0,this.scrollChange=!0),window.pageXOffset!=this.lastX&&(this.scrollChange=!0,this.scrollXVelocity=Math.floor(window.pageXOffset-this.lastX),this.lastX=window.pageXOffset),window.pageYOffset!=this.lastY&&(this.scrollChange=!0,this.scrollYVelocity=Math.floor(window.pageYOffset-this.lastY),this.lastY=window.pageYOffset),i!=this.lastWidth&&(this.lastWidth=i,this.scrollHeight=document.body.scrollHeight,this.sizeChange=!0),e!=this.lastHeight&&(this.lastHeight=e,this.sizeChange=!0),this.mouseXVelocity.length>5&&this.mouseXVelocity.shift(),this.mouseXVelocity.push(s-this.lastMouseX),h(this.mouseXVelocity)!=this.lastMouseXVelocity&&(this.lastMouseXVelocity=h(this.mouseXVelocity),this.mouseChange=!0),s!=this.lastMouseX&&(this.lastMouseX=s,this.mouseChange=!0),this.mouseYVelocity.length>5&&this.mouseYVelocity.shift(),this.mouseYVelocity.push(a-this.lastMouseY),h(this.mouseYVelocity)!=this.lastMouseYVelocity&&(this.lastMouseYVelocity=h(this.mouseYVelocity),this.mouseChange=!0),a==this.lastMouseY&&0==h(this.mouseYVelocity)||(this.lastMouseY=a,this.mouseChange=!0),o!=this.lastAlpha&&(this.lastAlpha=o,this.orientationChange=!0),n!=this.lastBeta&&(this.lastBeta=n,this.orientationChange=!0),l!=this.lastGamma&&(this.lastGamma=l,this.orientationChange=!0),(this.positionChange||this.sizeChange)&&(this.currDevicePixelRatio=Math.max(window.devicePixelRatio||1,1),this.currDevicePixelRatio!==this.lastDevicePixelRatio&&(this.devicePixelRatioChange=!0,this.lastDevicePixelRatio=this.currDevicePixelRatio)),(this.scrollChange||this.sizeChange||this.mouseChange||this.positionChange||this.orientationChange||this.devicePixelRatioChange)&&this.callbacks.forEach(function(i){return i(t.formatData())}),this.updating=!1,requestAnimationFrame(this.update)}},{key:"watch",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("function"!=typeof t)throw new Error("Value passed to Watch is not a function");if(!o){if(i){var e=this.formatData();e.scroll.changed=!0,e.mouse.changed=!0,e.size.changed=!0,e.position.changed=!0,e.orientation.changed=!0,e.devicePixelRatio.changed=!0,t(e)}this.callbacks.push(t)}}},{key:"unwatch",value:function(t){if("function"!=typeof t)throw new Error("The value passed to unwatch is not a function");o||(this.callbacks=this.callbacks.filter(function(i){return i!==t}))}}]),t}());o||(window.__TORNIS={watchViewport:n.watch,unwatchViewport:n.unwatch,getViewportState:n.formatData,recalibrateOrientation:n.recalibrateOrientation});var l=n.watch,r=n.unwatch,c=n.formatData,u=n.recalibrateOrientation;t.getViewportState=c,t.recalibrateOrientation=u,t.unwatchViewport=r,t.watchViewport=l,Object.defineProperty(t,"__esModule",{value:!0})});
